ZiLOG ZNeo ANSI C Compiler Version 1.10	Feb 27 2011	00:45:40	page: 1
Local	Global	File: C:\USERS\MATT\DOCUMENTS\CSCI-4415-LABS\HARLAN-LAB3\OSCILLATOR.C

     1	    1	#include "oscillator.h"
     2	   22	
     3	   23	#include <zneo.h>
     4	  549	
     5	  550	static int osc_clock;
     6	  551	
     7	  552	#define CLOCK_5_52MHZ   5520000
     8	  553	#define CLOCK_18_432MHZ 18432000
     9	  554	
    10	  555	/*
    11	  556		Unlocks the oscillator control register and selects either
    12	  557		the 5.5 or 18.43 mHz oscillator.
    13	  558	
    14	  559		OSC_5_52MHZ or OSC_18_432MHZ
    15	  560	 */
    16	  561	void init_oscillator(int osc)
    17	  562	{
    18	  563		// unlock the oscillator control register
    19	  564		OSCCTL = 0xE7; OSCCTL = 0x18;  
    20	  565	   
    21	  566		if(osc == OSC_18_432MHZ) {                 
    22	  567			// 61 = 0110_0001 = external 18.432 Hz
    23	  568			OSCCTL = 0x61;
    24	  569			osc_clock = CLOCK_18_432MHZ;
    25	  570		}
    26	  571		//default oscillator setting
    27	  572		else {
    28	  573			// A0 = 1010_0000 = internal 5.52 MHz
    29	  574			OSCCTL = 0xA0;
    30	  575			osc_clock = CLOCK_5_52MHZ;
    31	  576		}
    32	  577	}
    33	  578	
    34	  579	/*
    35	  580	 	Return the current oscillator clockspeed in Hz.
    36	  581	 */
    37	  582	int get_osc_clock(void)
    38	  583	{
    39	  584		return osc_clock;
    40	  585	}
    41	  586	ÿ
