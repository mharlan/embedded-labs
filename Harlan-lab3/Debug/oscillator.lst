ZiLOG ZNEO Macro Assembler Version 1.10 (07022203)                                               01-Mar-11     04:58:45     page:   1


PC     Object              I  Line    Source 
                           A     1    ; ZiLOG ZNEO ANSI C Compiler Release 1.11
                           A     2    ; -nolocalcse -optsize -model=S -nomodsect -noregvar
                           A     3    ; -reduceopt -debug -peephole -const=ROM -alias -fastcall
                           A     4    	FILE	"..\OSCILLATOR.C"
                           A     5    .debug "C"
                           A     6    	SEGMENT NEAR_BSS
00000000                   A     7    _osc_clock:
00000000                   A     8    	DS	4*1
                           A     9    .define "osc_clock"
                           A    10    .alias "_osc_clock"
                           A    11    .class 147
                           A    12    .value _osc_clock
                           A    13    .type 5
                           A    14    .type 0
                           A    15    .endef
                           A    16    ;    1	#include "oscillator.h"
                           A    17    ;    2	
                           A    18    ;    3	#include <zneo.h>
                           A    19    ;    4	
                           A    20    ;    5	static int osc_clock;
                           A    21    	SEGMENT CODE
                           A    22    ;    6	
                           A    23    ;    7	#define CLOCK_5_52MHZ   5520000
                           A    24    ;    8	#define CLOCK_18_432MHZ 18432000
                           A    25    ;    9	
                           A    26    ;   10	/*
                           A    27    ;   11		Unlocks the oscillator control register and selects either
                           A    28    ;   12		the 5.5 or 18.43 mHz oscillator.
                           A    29    ;   13	
                           A    30    ;   14		OSC_5_52MHZ or OSC_18_432MHZ
                           A    31    ;   15	 */
                           A    32    ;   16	void init_oscillator(int osc)
                           A    33    ;   17	{
00000000                   A    34    _init_oscillator:
                           A    35    .define "_init_oscillator"
                           A    36    .value _init_oscillator
                           A    37    .class 2
                           A    38    .type 65
                           A    39    .type 0
                           A    40    .endef
                           A    41    .begfunc "init_oscillator",17,"_init_oscillator"
                           A    42    .line 17
                           A    43    .define "osc"
                           A    44    .class 17
                           A    45    .reg 2
                           A    46    .type 5
                           A    47    .type 0
                           A    48    .endef
00000000 0800              A    49    	LINK	#0
                           A    50    ;   18		// unlock the oscillator control register
                           A    51    ;   19		OSCCTL = 0xE7; OSCCTL = 0x18;  
                           A    52    .line 19
ZiLOG ZNEO Macro Assembler Version 1.10 (07022203)                                               01-Mar-11     04:58:45     page:   2


PC     Object              I  Line    Source oscillator.src
00000002 4500 00E7         A    53    	LD	R0,#231
00000006 0350 E0A0         A    54    	LD.B	57504:RAM,R0
0000000A 3018              A    55    	LD	R0,#24
0000000C 0350 E0A0         A    56    	LD.B	57504:RAM,R0
                           A    57    ;   20	   
                           A    58    ;   21		if(osc == OSC_18_432MHZ) {                 
                           A    59    .line 21
00000010 9102              A    60    	CP	R1,#2
00000012 EE 09             A    61    	JP	NE,_1_L_1
                           A    62    ;   22			// 61 = 0110_0001 = external 18.432 Hz
                           A    63    ;   23			OSCCTL = 0x61;
                           A    64    .line 23
00000014 3061              A    65    	LD	R0,#97
00000016 0350 E0A0         A    66    	LD.B	57504:RAM,R0
                           A    67    ;   24			osc_clock = CLOCK_18_432MHZ;
                           A    68    .line 24
0000001A 4520 01194000     A    69    	LD	R0,#18432000
00000020 0370 0000         A    70    	LD	_osc_clock:RAM,R0
                           A    71    ;   25		}
                           A    72    ;   26		//default oscillator setting
                           A    73    ;   27		else {
                           A    74    .line 27
00000024 C009              A    75    	JP	_1_L_2
00000026                   A    76    _1_L_1:
                           A    77    ;   28			// A0 = 1010_0000 = internal 5.52 MHz
                           A    78    ;   29			OSCCTL = 0xA0;
                           A    79    .line 29
00000026 4500 00A0         A    80    	LD	R0,#160
0000002A 0350 E0A0         A    81    	LD.B	57504:RAM,R0
                           A    82    ;   30			osc_clock = CLOCK_5_52MHZ;
                           A    83    .line 30
0000002E 4520 00543A80     A    84    	LD	R0,#5520000
00000034 0370 0000         A    85    	LD	_osc_clock:RAM,R0
                           A    86    ;   31		}
                           A    87    ;   32	}
00000038                   A    88    _1_L_2:
                           A    89    .line 32
00000038 0001              A    90    	UNLINK	
0000003A FFFC              A    91    	RET	
                           A    92    
                           A    93    
                           A    94    ;**************************** _init_oscillator ***************************
                           A    95    ;Name                         Addr/Register   Size   Type
                           A    96    ;_osc_clock                          STATIC      4   variable
                           A    97    ;osc                                     R1      4   parameter
                           A    98    
                           A    99    
                           A   100    ; Aggregate Stack Size: 0 (words)
                           A   101    
                           A   102    
                           A   103    .endfunc "init_oscillator",32,"_init_oscillator"
                           A   104    ;   33	
ZiLOG ZNEO Macro Assembler Version 1.10 (07022203)                                               01-Mar-11     04:58:45     page:   3


PC     Object              I  Line    Source oscillator.src
                           A   105    ;   34	/*
                           A   106    ;   35	 	Return the current oscillator clockspeed in Hz.
                           A   107    ;   36	 */
                           A   108    ;   37	int get_osc_clock(void)
                           A   109    ;   38	{
0000003C                   A   110    _get_osc_clock:
                           A   111    .define "_get_osc_clock"
                           A   112    .value _get_osc_clock
                           A   113    .class 2
                           A   114    .type 69
                           A   115    .type 0
                           A   116    .endef
                           A   117    .begfunc "get_osc_clock",38,"_get_osc_clock"
0000003C 0800              A   118    	LINK	#0
                           A   119    ;   39		return osc_clock;
                           A   120    .line 39
0000003E 0340 0000         A   121    	LD	R0,_osc_clock:RAM
                           A   122    ;   40	}
                           A   123    .line 40
00000042 0001              A   124    	UNLINK	
00000044 FFFC              A   125    	RET	
                           A   126    
                           A   127    
                           A   128    ;**************************** _get_osc_clock ***************************
                           A   129    ;Name                         Addr/Register   Size   Type
                           A   130    ;_osc_clock                          STATIC      4   variable
                           A   131    
                           A   132    
                           A   133    ; Aggregate Stack Size: 0 (words)
                           A   134    
                           A   135    
                           A   136    .endfunc "get_osc_clock",40,"_get_osc_clock"
                           A   137    ;   41	
                           A   138    ;   42	void oscillator_settings_display(void)
                           A   139    ;   43	{
00000046                   A   140    _oscillator_settings_display:
                           A   141    .define "_oscillator_settings_display"
                           A   142    .value _oscillator_settings_display
                           A   143    .class 2
                           A   144    .type 65
                           A   145    .type 0
                           A   146    .endef
                           A   147    .begfunc "oscillator_settings_display",43,"_oscillator_settings_display"
00000046 0800              A   148    	LINK	#0
                           A   149    ;   44		
                           A   150    ;   45	}
                           A   151    .line 45
00000048 0001              A   152    	UNLINK	
0000004A FFFC              A   153    	RET	
                           A   154    
                           A   155    
                           A   156    ;**************************** _oscillator_settings_display ***************************
ZiLOG ZNEO Macro Assembler Version 1.10 (07022203)                                               01-Mar-11     04:58:45     page:   4


PC     Object              I  Line    Source oscillator.src
                           A   157    ;Name                         Addr/Register   Size   Type
                           A   158    
                           A   159    
                           A   160    ; Aggregate Stack Size: 0 (words)
                           A   161    
                           A   162    
                           A   163    .endfunc "oscillator_settings_display",45,"_oscillator_settings_display"
                           A   164    	XDEF _oscillator_settings_display
                           A   165    	XDEF _get_osc_clock
                           A   166    	XDEF _init_oscillator
                           A   167    	END


Errors: 0
Warnings: 0
Lines Assembled: 168
